<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Lost & Found - Realtime DB</title>
    <style>
    /* --- Modern CSS Upgrade --- */
    :root {
        --primary-color: #2b3a67; /* ‡∏™‡∏µ‡∏Å‡∏£‡∏°‡∏ó‡πà‡∏≤‡∏´‡∏•‡∏±‡∏Å */
        --accent-color: #4966b1;  /* ‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏™‡∏ß‡πà‡∏≤‡∏á */
        --success-color: #2ecc71; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
        --danger-color: #e74c3c;  /* ‡∏™‡∏µ‡πÅ‡∏î‡∏á */
        --bg-gradient: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    }

    body { 
        font-family: 'Kanit', sans-serif; 
        background: var(--bg-gradient); 
        margin: 0; 
        color: #333; 
        min-height: 100vh;
    }

    .hidden { display: none !important; }

    /* Login Screen - ‡∏™‡πÑ‡∏ï‡∏•‡πå Glassmorphism */
    .full-screen { 
        .full-screen { 
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100vw;  /* ‡πÄ‡∏ï‡πá‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏à‡∏≠ */
    height: 100vh; /* ‡πÄ‡∏ï‡πá‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏à‡∏≠ */
    background: var(--bg-gradient); 
    display: flex; 
    justify-content: center; /* ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô */
    align-items: center;     /* ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
    z-index: 9999;
    margin: 0;
    padding: 0;
}

.login-card { 
    background: rgba(255, 255, 255, 0.95); 
    padding: 50px 40px; 
    border-radius: 24px; 
    text-align: center; 
    width: 100%;
    max-width: 380px; /* ‡∏Ñ‡∏∏‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ */
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    border: 1px solid rgba(255, 255, 255, 0.3);
    /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏•‡∏∏‡∏î */
    margin: auto; 
}

/* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°: ‡∏õ‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≠‡∏á input ‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏∂‡πâ‡∏ô */
.login-card input {
    display: block;
    width: 100%;
    box-sizing: border-box; /* ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å: ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ input ‡∏ó‡∏∞‡∏•‡∏∏‡∏Å‡∏≤‡∏£‡πå‡∏î */
}
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
        background:url('background.gif');
        background-size: cover;      /* ‡πÉ‡∏´‡πâ‡∏£‡∏π‡∏õ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ */
        background-position: center; /* ‡πÉ‡∏´‡πâ‡∏£‡∏π‡∏õ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á */
        background-attachment: fixed;
    }

    .login-card { 
        background: rgba(255, 255, 255, 0.95); 
        padding: 50px 40px; 
        border-radius: 20px; 
        text-align: center; 
        text-box: center;
        width: 350px; 
        box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        border: 1px solid rgba(255,255,255,0.5);
        animation: slideUp 0.5s ease;
    }

    .login-card h2 { color: var(--primary-color); margin-bottom: 5px; }

    .login-card input { 
        width: 100%; padding: 15px; margin: 20px 0; 
        border: 2px solid #e0e6ed; border-radius: 12px; 
        font-family: 'Kanit', sans-serif;
        font-size: 1rem;
        transition: 0.3s;
        box-sizing: border-box;
    }
    
    .login-card input:focus {
        border-color: var(--accent-color);
        outline: none;
        box-shadow: 0 0 0 4px rgba(73, 102, 177, 0.1);
    }

    .btn-login { 
        width: 100%; padding: 15px; 
        background: linear-gradient(45deg, var(--primary-color), var(--accent-color)); 
        color: white; border: none; border-radius: 12px; 
        cursor: pointer; font-size: 1.1rem; font-weight: 500;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .btn-login:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(73, 102, 177, 0.4); }

    /* Main Interface */
    .main-container { 
        max-width: 1200px; margin: 40px auto; 
        background: #ffffff; border-radius: 24px; 
        overflow: hidden; 
        box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        animation: fadeIn 0.8s ease;
    }

    .header { 
        background: white; 
        color: var(--primary-color); 
        padding: 25px 40px; 
        display: flex; justify-content: space-between; align-items: center; 
        border-bottom: 1px solid #eee;
    }
    .header h1 { margin: 0; font-size: 1.8rem; letter-spacing: -1px; }

    /* Input Section */
    .input-section { 
        padding: 30px; display: flex; gap: 15px; 
        justify-content: center; background: #f8fafc; 
        flex-wrap: wrap; border-bottom: 1px solid #eee; 
    }

    .input-section input { 
        padding: 12px 15px; border: 1px solid #cbd5e1; 
        border-radius: 10px; font-family: 'Kanit'; flex: 1; min-width: 200px;
        transition: 0.3s;
    }
    .input-section input:focus { border-color: var(--accent-color); outline: none; }

    button { font-family: 'Kanit', sans-serif; cursor: pointer; transition: 0.2s; }
    
    .btn-save { 
        background: var(--success-color); color: white; border: none; 
        padding: 12px 30px; border-radius: 10px; font-weight: 500; 
        box-shadow: 0 4px 6px rgba(46, 204, 113, 0.2);
    }
    .btn-save:hover { background: #27ae60; transform: translateY(-2px); }

    /* Custom File Upload Button style */
    button[onclick*="click()"] {
        background: white; border: 2px dashed var(--accent-color);
        color: var(--accent-color); padding: 10px 20px; border-radius: 10px;
    }
    button[onclick*="click()"]:hover { background: #f0f4ff; }

    /* Logout Button */
    button[onclick="handleLogout()"] {
        background: #fff0f0; color: var(--danger-color); 
        border: 1px solid #ffcccc; padding: 8px 20px; 
        border-radius: 8px; font-weight: 500;
    }
    button[onclick="handleLogout()"]:hover { background: var(--danger-color); color: white; border-color: var(--danger-color); }

    /* Table Styling */
    table { width: 100%; border-collapse: separate; border-spacing: 0; }
    th { 
        background: #f1f5f9; padding: 18px; text-align: left; 
        color: #64748b; font-weight: 500; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 1px;
        border-bottom: 2px solid #e2e8f0;
    }
    td { border-bottom: 1px solid #f1f5f9; padding: 20px 18px; vertical-align: middle; }
    
    /* Alternating Rows & Hover */
    tr:nth-child(even) { background-color: #fcfcfc; }
    tr:hover { background-color: #f1f5f9; transition: 0.2s; }

    /* Image Thumbnails */
    .thumb-img { 
        width: 120px; height: 80px; object-fit: cover; 
        border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
        transition: transform 0.2s;
    }
    .thumb-img:hover { transform: scale(1.5); z-index: 10; position: relative; border: 2px solid white; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }

    /* Loading Overlay */
    #loading { 
        position: fixed; top:0; left:0; width:100%; height:100%; 
        background: rgba(255,255,255,0.7); backdrop-filter: blur(5px);
        z-index: 20000; display: flex; justify-content: center; align-items: center; 
        font-size: 1.5rem; color: var(--primary-color); font-weight: 500;
    }

    /* Animations */
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
</style>
</head>
<body>

    <div id="loading" class="hidden">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>

    <div id="loginPage" class="full-screen">
        <div class="login-card">
            <h2>LOST & FOUND</h2>
            <p>‡∏Ç‡∏≠‡∏á‡πÉ‡∏Ñ‡∏£ ‡πÉ‡∏Ñ‡∏£‡∏Å‡πá‡∏£‡∏±‡∏Å</p>
            <input type="email" id="loginEmail" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÉ‡∏™‡πà @gmail.com)">
            <button class="btn-login" onclick="handleLogin()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
    </div>

    <div id="mainPage" class="main-container hidden">
        <div class="header">
            <h1 style="margin:0;">LOST & FOUND</h1>
            <div>
                <span id="userDisplay" style="margin-right:15px;"></span>
                <button onclick="handleLogout()" style="cursor:pointer;">Logout</button>
            </div>
        </div>

        <div class="input-section">
            <input type="text" id="itemName" placeholder="Info (‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î)">
            <input type="text" id="itemLocation" placeholder="Place (‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà)">
            <input type="file" id="itemImage" accept="image/*" style="display:none;" onchange="document.getElementById('fileName').innerText = this.files[0].name">
            <button onclick="document.getElementById('itemImage').click()">üì∏ <span id="fileName">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ</span></button>
            <button class="btn-save" onclick="saveData()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </div>

        <table>
            <thead>
                <tr>
                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                    <th>‡∏ú‡∏π‡πâ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ</th>
                    <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ</th>
                    <th>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
                    <th>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</th>
                </tr>
            </thead>
            <tbody id="displayArea"></tbody>
        </table>
    </div>

    <script>
        // ******************************************************
        // üî¥ ‡∏ß‡∏≤‡∏á URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å App Script ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ (‡∏´‡πâ‡∏≤‡∏°‡∏•‡∏∑‡∏°!)
        const API_URL = "https://script.google.com/macros/s/AKfycbyGa1mwedpYaRpMG3rnAvd4nzCUKfiHqvdKGqbfQtpf7ByqQn1cdw8Zp7CuRD-Eq1f4/exec"; 
        // ******************************************************

        let currentUser = localStorage.getItem('API_USER');

        window.onload = () => {
            if (currentUser) {
                showMainPage();
            } else {
                document.getElementById('loginPage').classList.remove('hidden');
            }
        };

        function showLoading(show) {
            const el = document.getElementById('loading');
            if(show) el.classList.remove('hidden');
            else el.classList.add('hidden');
        }

        function showMainPage() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('mainPage').classList.remove('hidden');
            document.getElementById('userDisplay').innerText = currentUser;
            fetchData(); // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
        }

        // --- 1. Login ‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏à‡∏≤‡∏Å Sheet Users ---
        function handleLogin() {
            const email = document.getElementById('loginEmail').value.trim();
            if(!email) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•");

            showLoading(true);
            
            // ‡∏¢‡∏¥‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà App Script ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ User
            fetch(API_URL + "?action=getUsers")
            .then(res => res.json())
            .then(users => {
                showLoading(false);
                const validUser = users.find(u => u.email === email);
                
                if (validUser) {
                    currentUser = validUser.email;
                    localStorage.setItem('API_USER', currentUser);
                    showMainPage();
                } else {
                    alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡πÉ‡∏ô Sheet 'Users'");
                }
            })
            .catch(err => {
                showLoading(false);
                alert("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Server ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: " + err);
            });
        }

        function handleLogout() {
            localStorage.removeItem('API_USER');
            location.reload();
        }

        // --- 2. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á Sheet Data ---
        function saveData() {
            const name = document.getElementById('itemName').value;
            const loc = document.getElementById('itemLocation').value;
            const fileInput = document.getElementById('itemImage');

            if(!name || !loc) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");

            showLoading(true);

            // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            const sendPost = (base64Img) => {
                const payload = {
                    action: 'save',
                    owner: currentUser,
                    name: name,
                    loc: loc,
                    img: base64Img || ""
                };

                fetch(API_URL, {
                    method: 'POST',
                    body: JSON.stringify(payload)
                })
                .then(res => res.text())
                .then(data => {
                    showLoading(false);
                    alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
                    // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ñ‡πà‡∏≤
                    document.getElementById('itemName').value = "";
                    document.getElementById('itemLocation').value = "";
                    fileInput.value = "";
                    document.getElementById('fileName').innerText = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ";
                    fetchData(); // ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
                })
                .catch(err => {
                    showLoading(false);
                    alert("Error: " + err);
                });
            };

            // ‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏π‡∏õ‡πÄ‡∏õ‡πá‡∏ô Base64 (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
            if (fileInput.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => sendPost(e.target.result);
                reader.readAsDataURL(fileInput.files[0]);
            } else {
                sendPost("");
            }
        }

        // --- 3. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Sheet Data ‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á ---
        function fetchData() {
            showLoading(true);
            fetch(API_URL + "?action=getData")
            .then(res => res.json())
            .then(data => {
                showLoading(false);
                const tbody = document.getElementById('displayArea');
                tbody.innerHTML = "";

                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡πÄ‡∏Å‡πà‡∏≤
                data.reverse().forEach(item => {
                    tbody.innerHTML += `
                        <tr>
                            <td>${item.time}</td>
                            <td>${item.owner}</td>
                            <td>${item.name}</td>
                            <td>${item.loc}</td>
                            <td>${item.img ? `<img src="${item.img}" class="thumb-img">` : '-'}</td>
                            <td><button onclick="deleteItem('${item.id}')" style="color:red;cursor:pointer;">‡∏•‡∏ö</button></td>
                        </tr>
                    `;
                });
            });
        }

        // --- 4. ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ---
        function deleteItem(id) {
            if(!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÅ‡∏ñ‡∏ß‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?")) return;
            
            showLoading(true);
            fetch(API_URL, {
                method: 'POST',
                body: JSON.stringify({ action: 'delete', id: id })
            })
            .then(res => res.text())
            .then(data => {
                fetchData(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
            });
        }
    </script>
</body>
</html>